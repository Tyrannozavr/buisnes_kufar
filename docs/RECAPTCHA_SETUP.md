# Настройка reCAPTCHA v3

## Получение ключей reCAPTCHA

1. Перейдите на [Google reCAPTCHA Admin Console](https://www.google.com/recaptcha/admin)
2. Нажмите "+" для создания нового сайта
3. Выберите тип "reCAPTCHA v3"
4. Добавьте домены:
   - `localhost` (для разработки)
   - `tradesynergy.ru` (для продакшена)
   - `www.tradesynergy.ru` (для продакшена)
5. Примите условия использования
6. Нажмите "Submit"

## Полученные ключи

После создания сайта вы получите два ключа:
- **Site Key** (публичный ключ) - используется на фронтенде
- **Secret Key** (секретный ключ) - используется на бэкенде

## Настройка в проекте

### 1. Бэкенд (backend/app/core/config.py)

Замените моковые ключи на реальные:

```python
# reCAPTCHA v3 settings
RECAPTCHA_SECRET_KEY: str = "ВАШ_СЕКРЕТНЫЙ_КЛЮЧ_ЗДЕСЬ"
RECAPTCHA_SITE_KEY: str = "ВАШ_ПУБЛИЧНЫЙ_КЛЮЧ_ЗДЕСЬ"
RECAPTCHA_MIN_SCORE: float = 0.5  # Минимальный балл для прохождения проверки
```

### 2. Фронтенд (frontend/plugins/recaptcha.ts)

Замените моковый ключ на реальный:

```typescript
siteKey: 'ВАШ_ПУБЛИЧНЫЙ_КЛЮЧ_ЗДЕСЬ',
```

### 3. Зависимости

Проект уже использует `httpx` для HTTP-запросов, поэтому дополнительных зависимостей не требуется.

## Как это работает

1. **Фронтенд**: При отправке формы автоматически выполняется reCAPTCHA v3
2. **Бэкенд**: Получает токен и проверяет его через Google API используя `httpx`
3. **Безопасность**: Проверяется не только токен, но и балл (score) от 0.0 до 1.0
4. **UX**: Пользователь не видит капчу - она работает в фоне

## Настройка баллов

- `0.0` - Бот
- `1.0` - Человек
- Рекомендуемый минимум: `0.5`

Можно настроить в `RECAPTCHA_MIN_SCORE` в зависимости от требований безопасности.

## Тестирование

1. Запустите бэкенд: `cd backend && poetry run uvicorn app.main:app --reload`
2. Запустите фронтенд: `cd frontend && npm run dev`
3. Перейдите на страницу регистрации
4. Попробуйте зарегистрироваться - reCAPTCHA должна работать автоматически

## Отладка

Если возникают проблемы:

1. Проверьте консоль браузера на ошибки
2. Проверьте логи бэкенда
3. Убедитесь, что домены добавлены в reCAPTCHA Admin Console
4. Проверьте, что ключи правильно скопированы 