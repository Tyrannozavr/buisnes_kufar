# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∑–∞–∫–∞–∑–æ–≤

## –î–∞—Ç–∞: 23.10.2025

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   - –°–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã: `orders`, `order_items`, `order_history`, `order_documents`, `units_of_measurement`
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫

2. **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ 25 –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è —Å –∫–æ–¥–∞–º–∏ –û–ö–ï–ò
   - –î–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¢–ó_–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ.txt

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã**
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
   - ‚úÖ JSON —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**
   - ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ SQLAdmin
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–ª—è, —Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
   - ‚úÖ –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –∏–∫–æ–Ω–∫–∏

5. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**
   - ‚úÖ `/api/v1/purchases/units` - —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ª—É—á–µ–Ω–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è)
   - ‚ùå `/api/v1/purchases/deals` - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞)
   - ‚ùå `/api/v1/purchases/buyer/deals` - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è)

## ‚ö†Ô∏è –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: greenlet_spawn error

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ API –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; 
can't call await_only() here. Was IO attempted in an unexpected place?
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤ SQLAlchemy –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ async –∑–∞–ø—Ä–æ—Å–æ–≤. 
–í–µ—Ä–æ—è—Ç–Ω–æ, —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π async —Å–µ—Å—Å–∏–π –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–ü—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
1. –ò–∑–º–µ–Ω–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å async –Ω–∞ sync
2. –£–±—Ä–∞–Ω—ã selectinload –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤
4. –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä

**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ SQL:
- **–ó–∞–∫–∞–∑ ID 9**: 
  - –ü–æ–∫—É–ø–∞—Ç–µ–ª—å: –û–û–û –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å (ID: 20)
  - –ü—Ä–æ–¥–∞–≤–µ—Ü: –û–û–û –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (ID: 11)
  - –¢–∏–ø: GOODS (–¢–æ–≤–∞—Ä—ã)
  - –°—Ç–∞—Ç—É—Å: ACTIVE
  - –°—É–º–º–∞: 1005.00 —Ä—É–±

- **–ü–æ–∑–∏—Ü–∏—è –∑–∞–∫–∞–∑–∞ ID 10**:
  - –¢–æ–≤–∞—Ä: "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä 1"
  - –ê—Ä—Ç–∏–∫—É–ª: TEST001
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 10 —à—Ç
  - –¶–µ–Ω–∞: 100.50 —Ä—É–±
  - –°—É–º–º–∞: 1005.00 —Ä—É–±

- **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π ID 7**:
  - JSON –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - old_data: `{"test": "old_value", "number": 123}`
  - new_data: `{"test": "new_value", "number": 456, "array": [1, 2, 3]}`

- **–î–æ–∫—É–º–µ–Ω—Ç ID 1**:
  - –¢–∏–ø: invoice
  - –ù–æ–º–µ—Ä: INV-001
  - JSON —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ: `{"amount": 1005.00, "items": [{"name": "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä", "price": 100.50}]}`

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
   - –ò–∑—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É async —Å–µ—Å—Å–∏–π –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ë–î –≤ db/dependencies.py
   - –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ –∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º

2. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π SQLAlchemy –¥–ª—è —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è
   - –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ –æ–±—Ä–∞–∑—Ü—É —Ä–∞–±–æ—á–∏—Ö –º–æ–¥—É–ª–µ–π
   - –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:**
   - –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–ª–∞–¥–∫–∏

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∞–±–ª–∏—Ü—ã
- –ú–æ–¥–µ–ª–∏ SQLAlchemy
- –°—Ö–µ–º—ã Pydantic
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è API
- –ü—Ä—è–º—ã–µ SQL –æ–ø–µ—Ä–∞—Ü–∏–∏
- JSON —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

## ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- API —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- API –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- Async –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:

–°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ 80%. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É –∏ –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã. 
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å async/await –≤ API —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ SQLAlchemy –∏ FastAPI.

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ async –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ API.
